{% extends "base.html" %}

{% block content %}
  {{ super() }}
  
  <!-- Pagefind Search Modal -->
  <div id="pagefind-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--md-default-bg-color); border-radius: 1rem; padding: 2rem; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2 style="margin: 0; color: var(--md-primary-fg-color);">Search Vinyl Lexicon</h2>
        <button id="pagefind-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--md-default-fg-color);">&times;</button>
      </div>
      <div id="pagefind-search"></div>
    </div>
  </div>

  <script>
    // Initialize Pagefind UI
    new PagefindUI({
      element: "#pagefind-search",
      showImages: false,
      showSubResults: true,
      resetStyles: false,
      translations: {
        placeholder: "Search vinyl terminology...",
        clear_search: "Clear",
        load_more: "Load more results",
        search_label: "Search",
        filters_label: "Filters",
        zero_results: "No results found",
        many_results: "{{count}} results found",
        one_result: "1 result found",
        alt_search: "No results for \"{{term}}\". Showing results for \"{{alt_term}}\" instead.",
        search_suggestion: "No results for \"{{term}}\". Try one of the following searches:"
      }
    });

    // Search trigger functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Add search button to navigation
      const nav = document.querySelector('.md-header__inner');
      if (nav) {
        const searchButton = document.createElement('button');
        searchButton.className = 'pagefind-search-trigger';
        searchButton.innerHTML = 'üîç Search';
        searchButton.style.marginLeft = '1rem';
        searchButton.onclick = function() {
          document.getElementById('pagefind-modal').style.display = 'block';
          document.getElementById('pagefind-search').querySelector('input').focus();
        };
        nav.appendChild(searchButton);
      }

      // Close modal functionality
      document.getElementById('pagefind-close').onclick = function() {
        document.getElementById('pagefind-modal').style.display = 'none';
      };

      // Close modal on escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          document.getElementById('pagefind-modal').style.display = 'none';
        }
      });

      // Close modal on background click
      document.getElementById('pagefind-modal').onclick = function(e) {
        if (e.target === this) {
          this.style.display = 'none';
        }
      };
    });
  </script>
{% endblock %}
