# Waxly Architecture

## Overview

Waxly is a static MkDocs site with Material theme, deployed via GitHub Pages at hellowaxly.com.

## Content Structure

**Term Files**: `docs/terms/{letter}/{slug}.md`
- Each term is a Markdown file with YAML front-matter containing structured metadata
- Content follows encyclopedia-style format with definitions, etymology, examples, and cultural notes

**Schema Validation**: `schema/term.schema.json`
- Defines required fields and validation rules for term front-matter
- Enforces data consistency across all terms

**Navigation Hubs**:
- Auto-generated letter pages in `docs/letters/` for A-Z browsing
- Auto-generated tag pages in `docs/tags/` for category-based navigation
- **Important**: These directories are generated by scripts and should never be edited manually

**API Endpoint**: `api/terms.json`
- JSON export for programmatic access to all terms
- Generated by `scripts/generate_api.py`

**Search**: Client-side search via MkDocs Material + Pagefind

## Data Flow

1. **Source**: Term files have YAML front-matter (metadata) + Markdown body (content)
2. **Processing**: Python scripts in `scripts/` validate, process, and generate navigation
3. **Hooks**: Pre-commit hooks run validation and auto-generation on file changes
4. **Build**: MkDocs builds static site from `docs/` to `site/`
5. **Deploy**: GitHub Actions deploys to GitHub Pages on push to master branch

## Term Metadata Schema

Each term includes:
- **Core fields**: term, slug, pos, summary, tags
- **Taxonomies**: regions, domains, complexity, popularity
- **Lifecycle**: created, updated, status, verification
- **Cross-references**: see_also field links to related terms via slugs
- **Auto-linking**: `autolink_cross_references.py` processes cross-references between terms

## Key Scripts

Located in `scripts/`:

- `validate_terms.py` - Validate term front-matter against schema (warnings only)
- `fix_validation_issues.py` - Auto-fix common metadata problems
- `generate_letter_hubs.py` - Create A-Z navigation pages
- `generate_tag_hubs.py` - Create tag-based navigation pages
- `autolink_cross_references.py` - Add cross-links between related terms
- `generate_api.py` - Export all terms to JSON API
- `generate_aliases_redirects.py` - Handle term aliases and redirects
- `copy_as_markdown.py` - Export terms to plain markdown
- `version.py` - Manage project version numbers

## Pre-commit Hook Workflow

When committing term files, these hooks run automatically:

1. **fix-validation-issues** - Fixes common metadata issues
2. **regenerate-navigation** - Updates letter/tag hub pages
3. **autolink-references** - Adds cross-reference links
4. **test-mkdocs-build** - Ensures site builds successfully

**Note**: Validation hook (`validate-terms`) is manual-only to avoid blocking commits on warnings.

## Deployment

- **Trigger**: Push to master branch
- **Platform**: GitHub Actions (`.github/workflows/deploy.yml`)
- **Output**: Static site deployed to GitHub Pages
- **No manual steps**: Deployment is fully automated

## Directory Structure

```
/
├── docs/                    # Site content and term database
│   ├── terms/              # Individual term entries (organized A-Z)
│   ├── letters/            # Auto-generated letter navigation (do not edit)
│   ├── tags/               # Auto-generated tag navigation (do not edit)
│   ├── about.md            # Project information
│   └── contribute.md       # Contribution guidelines
├── schema/                 # Data structure documentation
│   └── term.schema.json    # Term validation schema
├── scripts/                # Python scripts for validation and generation
├── site/                   # Generated static site (not tracked in git)
├── api/                    # Generated JSON API
├── mkdocs.yml              # MkDocs configuration
└── .github/workflows/      # GitHub Actions deployment
```

## Term File Example

Each term file (e.g., `docs/terms/a/acetate.md`) contains YAML front-matter and Markdown content:

```yaml
---
term: "Acetate"
slug: "acetate"
pos: "noun"
aliases: ["lacquer", "reference disc"]
tags: ["equipment", "pressing", "mastering"]
domains: ["pressing_technique", "mastering"]
regions: ["US", "UK", "JA"]
eras: ["1940s", "1950s", "1960s"]
first_attested: "1940s"
pronunciation: "/ˈæsɪteɪt/"
see_also: ["dubplate", "lacquer cut", "reference disc"]
sources:
  - label: "Audio Engineering Society"
    url: "https://example.com"
summary: "A soft lacquer-coated aluminum disc used to cut the first playable copy"
updated: "2025-01-27"
popularity: 7
complexity: "intermediate"
status: "active"
context: "technical"
verification: "verified"
---

# Acetate

**Definition:** A soft lacquer-coated aluminum (or occasionally glass) disc used to cut the very first playable copy of a recording straight from the mastering lathe.

**Etymology:** Named for the nitrocellulose acetate lacquer layer applied over the disc's base.

**Example:** "I scored an acetate of a lost 1972 soul demo — the paper label is handwritten in ballpoint."

**Cultural Note:** In the '50s and '60s, DJs prized acetates for breaking brand-new singles in clubs before commercial pressings existed.
```

## Architecture Advantages

1. **Maximum Searchability**: Each term is individually indexed and searchable
2. **Rich Metadata**: 25+ fields per term for comprehensive categorization
3. **Scalability**: Easy to add new terms without restructuring
4. **API-Ready**: JSON export for external integrations
5. **Community-Friendly**: Clear contribution workflow with validation
6. **Future-Proof**: Extensible architecture for new features

## Technology Stack

- **Static Site Generator**: MkDocs
- **Theme**: Material for MkDocs
- **Search**: MkDocs Material search + Pagefind
- **Validation**: JSON Schema + Python
- **CI/CD**: GitHub Actions
- **Hosting**: GitHub Pages
- **Code Quality**: pre-commit hooks with Black, isort
