{% extends "base.html" %}

{% block content %}
  <!-- A-Z Navigation and Tags for Term Pages -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Only show on term pages
      const path = window.location.pathname;
      if (path.includes('/terms/')) {
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
        const azNav = document.createElement('div');
        azNav.className = 'waxly-az-nav';
        azNav.style.cssText = 'padding: 0.75rem 0; margin: 0 0 1.5rem 0; text-align: center; font-size: 11px; line-height: 1.8;';
        
        letters.forEach((letter, index) => {
          const link = document.createElement('a');
          link.href = `/waxly/letters/${letter.toLowerCase()}/`;
          link.textContent = letter;
          link.style.cssText = 'color: #999; text-decoration: none; transition: color 0.2s ease; padding: 0.25rem 0.35rem;';
          link.onmouseover = function() {
            this.style.color = '#ffb400';
          };
          link.onmouseout = function() {
            this.style.color = '#999';
          };
          azNav.appendChild(link);
          
          // Add pipe separator except after last letter
          if (index < letters.length - 1) {
            const separator = document.createElement('span');
            separator.textContent = ' | ';
            separator.style.cssText = 'color: #444;';
            azNav.appendChild(separator);
          }
        });
        
        // Insert at the top of the content area
        const contentInner = document.querySelector('.md-content__inner');
        if (contentInner) {
          contentInner.insertBefore(azNav, contentInner.firstChild);
        }
        
        // Extract and display tags from front matter
        const articleContent = document.querySelector('article.md-content__inner');
        if (articleContent) {
          // Look for the term metadata in the page
          const h1 = articleContent.querySelector('h1');
          if (h1) {
            // Try to extract tags from meta tags or page content
            const metaTags = document.querySelectorAll('meta[property="article:tag"]');
            const tags = Array.from(metaTags).map(tag => tag.content);
            
            // If no meta tags found, check if there's a data attribute or extract from the page
            if (tags.length === 0) {
              // Look for tags in the page structure (MkDocs Material may expose them)
              const pageMeta = document.querySelector('.md-source-file');
              // We'll add tags via CSS injection from the YAML front matter
            }
            
            // For now, create a placeholder for tags that will be populated
            const tagsContainer = document.createElement('div');
            tagsContainer.className = 'waxly-tags';
            tagsContainer.style.cssText = 'margin: 1rem 0 1.5rem 0; display: flex; flex-wrap: wrap; gap: 0.4rem; align-items: center;';
            tagsContainer.id = 'term-tags-container';
            
            // Insert tags container after H1
            h1.parentNode.insertBefore(tagsContainer, h1.nextSibling);
          }
        }
      }
    });
  </script>

  {{ super() }}

  <!-- Related Terms at Bottom of Page -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const path = window.location.pathname;
      if (path.includes('/terms/')) {
        // Load related terms data
        fetch('/waxly/data/related_terms.json')
          .then(response => response.json())
          .then(data => {
            const currentSlug = window.location.pathname.split('/').pop().replace('.html', '');
            const relatedData = data[currentSlug];

            if (relatedData && relatedData.related && relatedData.related.length > 0) {
              // Create related terms section at bottom
              const relatedSection = document.createElement('div');
              relatedSection.style.cssText = 'margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #333;';
              
              const heading = document.createElement('h3');
              heading.textContent = 'Related Terms';
              heading.style.cssText = 'color: #ffb400; font-size: 1.1rem; margin-bottom: 1rem;';
              relatedSection.appendChild(heading);
              
              const linksList = document.createElement('div');
              linksList.style.cssText = 'display: flex; flex-wrap: wrap; gap: 0.5rem;';
              
              relatedData.related.forEach(term => {
                const link = document.createElement('a');
                link.href = `../${term.path}/`;
                link.textContent = term.name;
                link.style.cssText = 'color: #50b7f5; text-decoration: none; padding: 0.4rem 0.8rem; background: rgba(80, 183, 245, 0.1); border-radius: 4px; font-size: 0.9rem; transition: all 0.2s ease;';
                link.onmouseover = function() {
                  this.style.background = 'rgba(80, 183, 245, 0.2)';
                  this.style.color = '#6cc5ff';
                };
                link.onmouseout = function() {
                  this.style.background = 'rgba(80, 183, 245, 0.1)';
                  this.style.color = '#50b7f5';
                };
                linksList.appendChild(link);
              });
              
              relatedSection.appendChild(linksList);
              
              // Insert at the end of main content
              const article = document.querySelector('article.md-content__inner');
              if (article) {
                article.appendChild(relatedSection);
              }
            }
          })
          .catch(error => console.log('Related terms not available:', error));
      }
    });
  </script>
{% endblock %}
